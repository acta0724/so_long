# so\_long

#### 概要

`so_long` は、42 プログラミングカリキュラムの課題として実装した、MiniLibX を用いたシンプルな 2D ゲームです。プレイヤーキャラクターを動かし、マップ上のコレクタブル（収集アイテム）をすべて回収し、出口までたどり着くことが目的となります。マップは `.ber` 拡張子のテキストファイルで定義され、以下の 5 種類の文字で構成されます：

* `0` … 空きマス
* `1` … 壁
* `C` … コレクタブル（収集アイテム）
* `E` … 出口
* `P` … プレイヤーの初期位置

マップは必ず四方を壁 (`1`) で囲む必要があり、必須として「コレクタブルが最低 1 個」「出口が 1 つ」「プレイヤー開始位置が 1 つ」を満たしていなければなりません。マップが条件を満たさない場合は、エラーを出力してプログラムを終了します。

---

## 動作環境・依存関係

* **開発言語**：C (C99 準拠)
* **ライブラリ**：

  * MiniLibX（ウィンドウ管理・画像表示用）
  * 自作 `libft`（42 プロジェクトで構築した共通関数群）
* **コンパイラ**：`cc` (GCC や Clang 等、C コンパイラが利用可能であれば可)
* **動作OS**：Linux または macOS（MiniLibX が動作する環境であること）

---

## ビルド方法

1. `libft` と `minilibx-linux` がリポジトリ内に配置されていることを確認します。
2. リポジトリのルートディレクトリで以下を実行：

   ```
   make
   ```

   * `Makefile` 内で自動的に `libft` と `minilibx-linux` のビルドが行われ、最終的に実行ファイル `so_long` が生成されます。
3. ビルド成功後、ルートに `so_long` 実行ファイルが出力されます。
4. クリーンアップしたい場合：

   ```
   make fclean
   ```

   * オブジェクトファイル、`so_long`、`libft.a`、`libmlx.a` が削除されます。

---

## 実行方法

ビルド後、以下のようにゲームを起動します：

```
./so_long <map_file>.ber
```

* `<map_file>.ber` は `.ber` 拡張子を持つマップファイルです。
* 例：

  ```
  ./so_long maps/example.ber
  ```

---

## マップファイル（.ber）の書き方

* **拡張子**：必ず `.ber`

* **構成文字**：1 行ごとに同じ文字数（矩形マップ）

  * `0` … 空きマス
  * `1` … 壁
  * `C` … コレクタブル
  * `E` … 出口
  * `P` … プレイヤーの初期位置

* **要件**：

  1. 矩形（すべての行が同一の長さ）
  2. 四辺はすべて `1`（壁）
  3. プレイヤー (`P`) がちょうど 1 つ
  4. 出口 (`E`) がちょうど 1 つ
  5. コレクタブル (`C`) は 1 つ以上
  6. プレイヤーからすべての `C` を取得し、`E` まで到達できる経路が存在

* **サンプル（最小構成例）**：

  ```
  111111
  1P0C01
  100001
  1C0E01
  111111
  ```

* **注意①**：各行の文字数が異なるとエラーになります。

* **注意②**：四辺が壁でない場合、エラー `Error\nMap is not enclosed by walls` を出力して終了します。

* **注意③**：`P`・`E`・`C` の数が要件を満たさない場合、それぞれ対応するエラーメッセージを出力します。

---

## 操作方法

* **移動キー**：

  * `W` … 上へ移動
  * `A` … 左へ移動
  * `S` … 下へ移動
  * `D` … 右へ移動
* **終了キー**：

  * `ESC` … ゲームを終了（ウィンドウを閉じる）
  * ウィンドウ右上の「×」ボタンでも終了可
* **画面表示**：

  * 移動するたび、ターミナルに現在のムーブ数が表示されます：

    ```
    Moves: 5
    ```
  * すべてのコレクタブルを回収し、出口に到達すると、以下の勝利メッセージが表示されゲーム終了：

    ```
    You won in 42 moves!
    ```

---

## エラー・例外処理

不正を検出した場合は、標準エラー出力にエラーメッセージを出して即座に終了します。

* **引数エラー**：

  ```
  Error
  Invalid arguments. Usage: ./so_long <map.ber>
  ```
* **拡張子エラー**：

  ```
  Error
  File must have .ber extension
  ```
* **ファイルオープン失敗**：

  ```
  Error
  Cannot open map file
  ```
* **マップが空／無効**：

  ```
  Error
  Invalid map
  ```
* **矩形でない**：

  ```
  Error
  Map is not rectangular
  ```
* **四辺が壁でない**：

  ```
  Error
  Map is not enclosed by walls
  ```
* **無効な文字が含まれる**：

  ```
  Error
  Map contains invalid characters
  ```
* **プレイヤー数が 1 つでない**：

  ```
  Error
  Invalid number of players (must be 1)
  ```
* **出口数が 1 つでない**：

  ```
  Error
  Invalid number of exits (must be 1)
  ```
* **コレクタブルが 0 個**：

  ```
  Error
  No collectibles found
  ```
* **有効な経路が存在しない**：

  ```
  Error
  No valid path to exit and collectibles
  ```
* **MiniLibX 初期化失敗**：

  ```
  Error
  MLX initialization failed
  ```
* **メモリ確保失敗**：

  ```
  Error
  Memory allocation failed
  ```
